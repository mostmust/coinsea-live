<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>김프 실시간 조회 - 코인씨</title>
  <meta name="description" content="업비트와 바이낸스 가격 차이를 실시간으로 확인하고 김프(프리미엄)를 계산합니다.">
  <style>
    body {
      font-family: 'Nanum Gothic', sans-serif;
      margin: 20px;
      background: #f7f7f7;
      color: #333;
    }
    h1 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #eee;
    }
    .positive {
      color: green;
    }
    .negative {
      color: red;
    }
    .timestamp {
      text-align: center;
      margin-top: 10px;
      color: #666;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>김프 실시간 조회</h1>
  <div class="timestamp" id="timestamp">데이터 불러오는 중...</div>
  <table>
    <thead>
      <tr>
        <th>코인</th>
        <th>업비트 (KRW)</th>
        <th>바이낸스 (USD)</th>
        <th>환산가 (KRW)</th>
        <th>김프 (%)</th>
      </tr>
    </thead>
    <tbody id="priceTable"></tbody>
  </table>

  <script>
    async function fetchData() {
      try {
        const res = await fetch('/.netlify/functions/prices');
        const json = await res.json();

        const { timestamp, usdToKrw, data } = json;
        const tbody = document.getElementById('priceTable');
        const time = document.getElementById('timestamp');

        tbody.innerHTML = ''; // 초기화
        time.textContent = `업데이트 시각: ${new Date(timestamp).toLocaleString()} (USD→KRW: ${usdToKrw.toFixed(2)})`;

        for (const symbol in data) {
          const { upbit, binance, binanceKrw, premium } = data[symbol];

          const row = document.createElement('tr');

          row.innerHTML = `
            <td>${symbol}</td>
            <td>${upbit ? upbit.toLocaleString() : '-'}</td>
            <td>${binance ? binance.toFixed(3) : '-'}</td>
            <td>${binanceKrw ? binanceKrw.toLocaleString(undefined, { maximumFractionDigits: 0 }) : '-'}</td>
            <td class="${premium > 0 ? 'positive' : 'negative'}">
              ${premium !== null ? premium + '%' : '-'}
            </td>
          `;

          tbody.appendChild(row);
        }
      } catch (err) {
        document.getElementById('timestamp').textContent = '데이터 로딩 오류: ' + err.message;
      }
    }

    fetchData();
    setInterval(fetchData, 60 * 1000); // 1분마다 자동 업데이트
  </script>
</body>
</html>
